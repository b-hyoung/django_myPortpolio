{% extends "blog/base.html" %}
{% load static %}

{% block title %}AI Search{% endblock %}

{% block content %}
<style>
/* Loading Overlay Styles */
#loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none; /* Hidden by default */
    justify-content: center;
    align-items: center;
    z-index: 1050; /* High z-index to be on top */
    color: white;
    text-align: center;
}
</style>

<!-- Loading Overlay HTML -->
<div id="loading-overlay">
    <div>
        <i class="bi bi-robot" style="font-size: 4rem;"></i>
        <h3 id="loading-text" class="mt-3">데이터를 가져오는중</h3>
    </div>
</div>


<div class="row justify-content-center">
    <div class="col-lg-10">

        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold text-info">AI Search</h1>
            <p class="lead text-body-secondary">궁금한 아이디어나 주제를 입력해 보세요. AI가 웹을 검색하여 한국어로 요약 정리해 드립니다.</p>
        </div>

        <div class="mb-5">
            <form id="ai-search-form" method="post" action="{% url 'ai_search:search' %}">
                {% csrf_token %}
                <div class="input-group input-group-lg">
                    <input type="text" class="form-control" placeholder="궁금한 것을 입력하세요 (예: 최신 웹 개발 트렌드)" aria-label="Search query" name="query" value="{{ query|default_if_none:'' }}">
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-robot"></i> 검색
                    </button>
                </div>
            </form>
        </div>

        {% if result or messages %}
        <div class="mt-5">
            {% if messages %}
                <div class="mb-4">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% if result %}
                <h3 class="h4 text-info mb-3"><i class="bi bi-card-text"></i> AI 검색 결과</h3>
                <div class="p-4 rounded-3" style="background-color: rgba(0,0,0,0.2);">
                    <div class="text-white mb-0">
                        {{ result|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
        {% endif %}
        
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('ai-search-form');
    const loadingOverlay = document.getElementById('loading-overlay');
    const loadingText = document.getElementById('loading-text');

    if (form && loadingOverlay && loadingText) {
        form.addEventListener('submit', function() {
            // Show the loading overlay
            loadingOverlay.style.display = 'flex';

            // Animate the loading text
            let messageIndex = 0;
            let dotCount = 1;
            const loadingMessages = [
                "AI가 데이터를 가져오는 중",
                "지민이가 릴스 보는 중",
                "AI가 데이터를 한국어로 변환 중",
                "조금만 기다려주세요. 거의 다 됐어요(- _-)(-_ -)"
            ];
            
            // Ensure the text starts with dots immediately
            loadingText.textContent = loadingMessages[messageIndex] + ' .';

            setInterval(function() {
                // Get the current base message
                const baseText = loadingMessages[messageIndex];
                
                // Create the animated ellipsis
                let dots = ' '.repeat(dotCount);
                dots = dots.replace(/ /g, '.'); // Create a string of dots

                // Update the text content
                loadingText.textContent = baseText + dots;

                // Increment dot count
                if (dotCount >= 4) {
                    dotCount = 1;
                    messageIndex = (messageIndex + 1) % loadingMessages.length;
                } else {
                    dotCount++;
                }
            }, 700); // Animation speed
        });
    }
});
</script>

{% endblock %}