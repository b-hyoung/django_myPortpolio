{% extends "blog/base.html" %}
{% load static %}
{% load blog_tags %}

{% block title %}Projects{% endblock %}
{% block custom_css %}
<style>
  .view-switch .btn.active {
    pointer-events: none;
  }
  .project-card {
    border: 1px solid var(--bs-border-color);
    border-radius: 14px;
    background: rgba(18, 18, 18, 0.62);
    height: 100%;
    transition: transform .16s ease, border-color .16s ease;
  }
  .project-card:hover {
    transform: translateY(-2px);
    border-color: rgba(123, 223, 242, .5);
  }
  .project-title { font-size: 1.02rem; font-weight: 700; color: #7bdff2; }
  .project-desc { font-size: .88rem; color: var(--bs-body-secondary-color); }
  .tech-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
  .tech-badge {
    border: 1px solid rgba(125, 223, 242, .45);
    color: #c9f5fb;
    background: transparent;
    border-radius: 999px;
    font-size: .72rem;
    padding: 2px 8px;
  }
  .project-row {
    border: 1px solid var(--bs-border-color);
    border-radius: 12px;
    background: rgba(18, 18, 18, 0.55);
    padding: 12px 14px;
  }
  .minimal-item {
    border-bottom: 1px dashed var(--bs-border-color);
    padding: 10px 4px;
  }
  .minimal-item:last-child { border-bottom: 0; }
  .bento-main {
    border: 1px solid rgba(123, 223, 242, .45);
    border-radius: 16px;
    background: linear-gradient(145deg, rgba(35, 60, 75, .35), rgba(18, 18, 18, .72));
    padding: 18px;
    height: 100%;
  }
  .case-wrap {
    border: 1px solid var(--bs-border-color);
    border-radius: 12px;
    overflow: hidden;
    background: rgba(18, 18, 18, 0.55);
  }
  .case-head, .case-row {
    display: grid;
    grid-template-columns: 2.1fr 1.2fr 1fr .8fr;
    gap: 12px;
    padding: 10px 14px;
    align-items: center;
  }
  .case-head {
    border-bottom: 1px solid var(--bs-border-color);
    font-size: .78rem;
    letter-spacing: .04em;
    color: var(--bs-body-secondary-color);
    text-transform: uppercase;
  }
  .case-row {
    border-bottom: 1px solid var(--bs-border-color);
    transition: background-color .15s ease;
  }
  .case-row:last-child { border-bottom: 0; }
  .case-row:hover { background: rgba(255, 255, 255, .03); }
  @media (max-width: 992px) {
    .case-head { display: none; }
    .case-row {
      grid-template-columns: 1fr;
      gap: 4px;
      padding: 12px 14px;
    }
  }
</style>
{% endblock %}

{% block content %}
<h1 class="h3 mb-4">Projects</h1>

<div class="view-switch d-flex gap-2 mb-3">
    <a href="?view=cards" class="btn btn-sm {% if view_mode == 'cards' %}btn-info active{% else %}btn-outline-info{% endif %}">카드형</a>
    <a href="?view=rows" class="btn btn-sm {% if view_mode == 'rows' %}btn-info active{% else %}btn-outline-info{% endif %}">행목록형</a>
    <a href="?view=bento" class="btn btn-sm {% if view_mode == 'bento' %}btn-info active{% else %}btn-outline-info{% endif %}">Bento형</a>
    <a href="?view=case" class="btn btn-sm {% if view_mode == 'case' %}btn-info active{% else %}btn-outline-info{% endif %}">Case형</a>
</div>

{% if view_mode == "cards" %}
<div class="row g-3">
    {% for project in projects %}
    <div class="col-12 col-md-6">
        <a href="{% url 'project_detail' project.id %}" class="text-decoration-none" style="color: inherit;">
            <div class="project-card p-3">
                <div class="project-title mb-2">{{ project.title }}</div>
                <div class="project-desc">{{ project.description|truncatewords:16 }}</div>
                <div class="tech-row">
                    {% for tech in project.technologies|split_technologies|slice:":4" %}
                        <span class="tech-badge">{{ tech }}</span>
                    {% endfor %}
                    {% if project.technologies|split_technologies|length > 4 %}
                        <span class="tech-badge">+{{ project.technologies|split_technologies|length|add:"-4" }}</span>
                    {% endif %}
                </div>
            </div>
        </a>
    </div>
    {% empty %}
    <div class="col-12 text-body-secondary">No projects yet.</div>
    {% endfor %}
</div>
{% elif view_mode == "rows" %}
<div class="d-flex flex-column gap-2">
    {% for project in projects %}
    <a href="{% url 'project_detail' project.id %}" class="text-decoration-none" style="color: inherit;">
        <div class="project-row">
            <div class="d-flex justify-content-between align-items-start gap-2">
                <strong class="project-title">{{ project.title }}</strong>
                <small class="text-body-secondary">{{ project.created_at|date:"Y.m.d" }}</small>
            </div>
            <div class="project-desc mt-1">{{ project.description|truncatewords:20 }}</div>
            <div class="tech-row">
                {% for tech in project.technologies|split_technologies|slice:":6" %}
                    <span class="tech-badge">{{ tech }}</span>
                {% endfor %}
            </div>
        </div>
    </a>
    {% empty %}
    <div class="text-body-secondary">No projects yet.</div>
    {% endfor %}
</div>
{% elif view_mode == "bento" %}
<div class="row g-3">
    {% for project in projects %}
    {% if forloop.first %}
    <div class="col-12">
        <a href="{% url 'project_detail' project.id %}" class="text-decoration-none" style="color: inherit;">
            <div class="bento-main">
                <div class="d-flex justify-content-between align-items-start gap-2 mb-2">
                    <div class="project-title" style="font-size:1.15rem;">{{ project.title }}</div>
                    <span class="tech-badge">{{ project.technologies|split_technologies|length }}개 스택</span>
                </div>
                <div class="project-desc mb-3">{{ project.description|truncatewords:28 }}</div>
                <div class="tech-row">
                    {% for tech in project.technologies|split_technologies|slice:":7" %}
                        <span class="tech-badge">{{ tech }}</span>
                    {% endfor %}
                </div>
            </div>
        </a>
    </div>
    {% else %}
    <div class="col-12 col-md-6">
        <a href="{% url 'project_detail' project.id %}" class="text-decoration-none" style="color: inherit;">
            <div class="project-card p-3">
                <div class="project-title mb-2">{{ project.title }}</div>
                <div class="project-desc">{{ project.description|truncatewords:14 }}</div>
                <div class="tech-row">
                    {% for tech in project.technologies|split_technologies|slice:":4" %}
                        <span class="tech-badge">{{ tech }}</span>
                    {% endfor %}
                </div>
            </div>
        </a>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<div class="case-wrap">
    <div class="case-head">
        <div>Project</div>
        <div>Role</div>
        <div>Period</div>
        <div>Stack</div>
    </div>
    {% for project in projects %}
    {% with profile=project_meta|dict_get:project.title %}
    <a href="{% url 'project_detail' project.id %}" class="text-decoration-none" style="color: inherit;">
        <div class="case-row">
            <div>
                <div class="fw-semibold">{{ project.title }}</div>
                <div class="small text-body-secondary">{{ project.description|truncatewords:10 }}</div>
            </div>
            <div class="small text-body-secondary">{{ profile.role|default:"-" }}</div>
            <div class="small text-body-secondary">{{ profile.period|default:"-" }}</div>
            <div class="small text-body-secondary">{{ project.technologies|split_technologies|length }}개</div>
        </div>
    </a>
    {% endwith %}
    {% empty %}
    <div class="p-3 text-body-secondary">No projects yet.</div>
    {% endfor %}
</div>
{% endif %}

{% endblock %}
